From f06cb0f7aea5a275c4ae4b35f19db407fa65a3f7 Mon Sep 17 00:00:00 2001
From: jakub <jakub@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Wed, 18 May 2011 09:29:46 +0000
Subject: [PATCH] 	PR tree-optimization/49000
 	* tree-ssa.c (execute_update_addresses_taken): Call
 	maybe_rewrite_mem_ref_base on debug stmt value.  If it couldn't
 	be rewritten and decl has been marked for renaming, reset
 	the debug stmt.

	* gcc.dg/pr49000.c: New test.


git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_6-branch@173850 138bc75d-0d04-0410-961f-82ee72b054a4

index 12ceb8e..d3585ce 100644
index 0455680..649f625 100644
--- a/gcc/tree-ssa.c
+++ b/gcc/tree-ssa.c
@@ -2205,6 +2205,17 @@ execute_update_addresses_taken (void)
 		  }
 	      }
 
+	    else if (gimple_debug_bind_p (stmt)
+		     && gimple_debug_bind_has_value_p (stmt))
+	      {
+		tree *valuep = gimple_debug_bind_get_value_ptr (stmt);
+		tree decl;
+		maybe_rewrite_mem_ref_base (valuep);
+		decl = non_rewritable_mem_ref_base (*valuep);
+		if (decl && symbol_marked_for_renaming (decl))
+		  gimple_debug_bind_reset_value (stmt);
+	      }
+
 	    if (gimple_references_memory_p (stmt)
 		|| is_gimple_debug (stmt))
 	      update_stmt (stmt);
-- 
1.7.0.4

