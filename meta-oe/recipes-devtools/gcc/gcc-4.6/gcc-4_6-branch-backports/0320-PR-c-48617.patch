From 67d72b54cf6df49411f806fac3b0519dbceaa576 Mon Sep 17 00:00:00 2001
From: jason <jason@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Wed, 25 May 2011 01:08:07 +0000
Subject: [PATCH] 	PR c++/48617
 	* pt.c (invalid_nontype_parm_type_p): Allow DECLTYPE_TYPE.

git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_6-branch@174158 138bc75d-0d04-0410-961f-82ee72b054a4

index d9c7ac4..8646f08 100644
--- a/gcc/cp/pt.c
+++ b/gcc/cp/pt.c
@@ -17867,6 +17867,8 @@ invalid_nontype_parm_type_p (tree type, tsubst_flags_t complain)
     return 0;
   else if (TREE_CODE (type) == TYPENAME_TYPE)
     return 0;
+  else if (TREE_CODE (type) == DECLTYPE_TYPE)
+    return 0;
 
   if (complain & tf_error)
     error ("%q#T is not a valid type for a template constant parameter", type);
new file mode 100644
index 0000000..cb962ad
--- /dev/null
+++ b/gcc/testsuite/g++.dg/cpp0x/decltype27.C
@@ -0,0 +1,9 @@
+// PR c++/48617
+// { dg-options -std=c++0x }
+
+template<class T, decltype(T())> // #
+struct A {};
+
+A<int, 0> a;
+
+int main() {}
-- 
1.7.0.4

